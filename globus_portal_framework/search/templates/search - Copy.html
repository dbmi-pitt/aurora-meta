{%extends "base.html"%}
{% load humanize %}
{% load static %}

{%block title%}Search{%endblock%}

{%block headextras%}
  <!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">

<!--
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
-->
<link rel="stylesheet" type="text/css" href="{% static 'css/search.css' %}" />
<script>
  /*
  This helper function ensures queries are inserted as the first query-param
  so that the search url is copy-pastable by the user
  */
  function customSearch(page={{ search.pagination.current_page|default:"1"}}) {
    //copy as a hidden field so we don't change the look of the page
    var page = $('<input>').attr({type: 'hidden', id: 'foo',
                                 name: 'page', value: page});
    console.log(page)
    var input = $('#search-input').clone().attr('type','hidden');
    $('#facet-form').prepend(page).prepend(input).submit();
  }

/*
function viewDoc() {
    var x = document.getElementById("documentation");
    if (x.style.display === "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
}
*/
function replaceSingleQuotes(p1) {
      var s1 = p1.replace(/\'/g, '"')
    return s1
}

//try {
// var diseasedataRaw = replaceSingleQuotes("{{request.session.search.summarydata|safe}}");
// console.log(diseasedataRaw);
// var jdata = JSON.parse(diseasedataRaw);
// var diseasedata = jdata[0].values;

// // Load the Visualization API and the corechart package.
// google.charts.load('current', {'packages':['corechart']});

// // Set a callback to run when the Google Visualization API is loaded.
// google.charts.setOnLoadCallback(function(){ drawOverviewPieChart(diseasedata) });   //drawChart);
// } catch(err) {
//   console.log(err);
// } 


// manage the collapse/expand icons

$(document).ready(function() {
  $('.collapse').on('shown.bs.collapse', function() {
    console.log('shown event...');
    $(this).parent().find('.fa-angle-down').removeClass('fa-angle-down').addClass('fa-angle-up');
  }).on('hidden.bs.collapse', function() {
    console.log('hide event...');
    $(this).parent().find('.fa-angle-up').removeClass('fa-angle-up').addClass('fa-angle-down');
  })
});

</script>

{%endblock%}

{%block body%}
<div class="container">

<div class="search-grid-container">
    <div class="menu-grid">
<!--
      {% if request.session.search.summarydata %}      
        <div id="overview-chart"></div>
        click on the chart to display detail on a cancer
       {% endif %}
-->
      {% if search.facets %}
      <div id="filters">   
      <h3>Additional Filters</h3>
       <form id="facet-form-apply"> 
        <b>To narrow your search, make your selection(s) below and press:</b>
            <button id="search-btn" type="submit" class="btn btn-default" formaction="{% url 'submit_advanced' %}">
              <i class="fas fa-filter"></i>
              Apply
            </button>

        </form>    
        <div id="facet-container">
            <form id="facet-form" action="{% url 'advanced-filters' %}"> 
             {% include "components/search-facets-accord.html" %}
            </form>
        </div>
      </div>
      {% endif %}

      <!--<hr class="d-sm-none">-->
    </div>
    <div class="main-grid">
      <h3>Search</h3>
     <h6>You can search the database by entering any search term (e.g., "DNA" or "Lung"). Use the "Additional Filters" to add</h6>
      <h6>terms to the search and learn more about available search functions in the <a id="documentation" href="#" onclick="$('#dialogdoc').dialog('open');">advanced query documentation</a>
      <div id="dialogdoc" class="card" title="Query Help" style="display:none;">
         {% include 'components/query-info.html' %}        
      </div>
    <script>
        $(function() {
      $("#dialogdoc").dialog({
        autoOpen: false,
        show: {
          effect: "blind",
          duration: 1000
        },
          hide: {
            effect: "explode",
            duration: 1000
          },
        width:800,
        height:900,
        position: { my: "center", at: "center", of: window }
      });
      $("#documentation").on("click", function() {
        $("#dialogdoc").dialog("open");
      });
    });
    </script>

       <form id="search-form" class="my-4" name="search_form" action="{% url 'search' %}">
        <input type="text" id="search-input" autocomplete="off"
           data-provide="typeahead" name="q"
           value="{{request.session.search.query}}" placeholder="Search for a disease or condition (e.g., melanoma)">           
        <button id="search-btn" type="submit" class="btn btn-default">
          <i class="fas fa-search"></i>
        </button>
        <a class="reset-link" href="{% url 'search' %}">Reset</a>
      </form>
      <div class="container">    
            {% include "components/search-results.html" %}    
      </div>
  </div>
    </div>
</div>
</div>



<!--
<div class="jumbotron text-center" style="margin-bottom:0">
  <p>Footer</p>
</div>
-->
{% endblock %}


